      - name: ğŸ“¤ Prepare and transfer files
        run: |
          # Create a clean copy and fix permissions
          mkdir -p /tmp/deployment
          echo "ğŸ“‚ Copying files to temporary directory..."
          cp -r backend frontend docker-compose.prod.yml nginx.conf /tmp/deployment/
          
          # Copy .env.production if it exists
          cp .env.production /tmp/deployment/ 2>/dev/null || echo "â„¹ï¸ .env.production not found, will need to create manually"
          
          # Fix permissions in the temporary directory
          echo "ğŸ”§ Fixing file permissions..."
          chmod -R 755 /tmp/deployment/
          chown -R $(id -u):$(id -g) /tmp/deployment/ || true
          
          echo "ğŸ“¦ Creating archive..."
          cd /tmp/deployment
          tar -czf /tmp/deployment.tar.gz .
          
          echo "ğŸš€ Transferring to EC2..."
          scp -i ~/.ssh/ec2_key.pem /tmp/deployment.tar.gz ubuntu@${{ secrets.EC2_HOST }}:/tmp/
          echo "âœ… Files transferred successfully"